!function(e){function t(e){this.res={},this.noData=!1,this.notMatch=!1,this.dragSearchArea=null,this.dragSearchHeader=null,this.dragSearchText=null,this.dragSearchCaret=null,this.dragSearchContent=null,this.dragSearchInput=null,this.dragSearchHidden=null,this.dragSearchList=null,this.dragSearchNoData=null,this.dragSearchNotMatch=null,this.init(e)}t.prototype.init=function(t){if(!t||"object"!=typeof t)throw new Error("传入参数不正确");if(this.json=t,this.select=e.getElementById(t.id),!this.select)throw new Error("给定id的元素不存在！");this.selectWidth=this.select.offsetWidth,this.selectHeight=this.select.offsetHeight,this.userConfig=t.config,this.defaultConfig={tip:"请选择",placeholder:"",maxHeight:"300px"},this.config=this.extend(this.userConfig,this.defaultConfig),this.createElement(t)},t.prototype.createElement=function(e){this.createArea(),this.createHeader(),this.createContent(e);var t=this.select.parentNode;t.replaceChild(this.dragSearchArea,this.select)},t.prototype.createArea=function(){this.dragSearchArea=e.createElement("div");var t=this.getByClass("dragSearch-area",e),a="dragSearch-area-1";t&&t.length&&(a="dragSearch-area-"+(t.length+1)),this.dragSearchArea.className="dragSearch-area "+a,this.dragSearchArea.style.width=this.selectWidth+"px",this.dragSearchArea.style.height=this.selectHeight+"px"},t.prototype.createHeader=function(){this.dragSearchHeader=e.createElement("div"),this.dragSearchHeader.className="dragSearch-header",this.dragSearchHeader.style.width=this.selectWidth+"px",this.dragSearchHeader.style.height=this.select.offsetHeight+"px",this.dragSearchHeader.style.lineHeight=this.selectHeight+"px",this.dragSearchText=e.createElement("div"),this.dragSearchText.className="dragSearch-text",this.dragSearchText.innerHTML=this.config.tip,this.dragSearchHeader.appendChild(this.dragSearchText),this.dragSearchCaret=e.createElement("span"),this.dragSearchCaret.className="dragSearch-caret dragSearch-caret-down",this.dragSearchHeader.appendChild(this.dragSearchCaret),this.dragSearchArea.appendChild(this.dragSearchHeader)},t.prototype.createContent=function(t){this.dragSearchContent=e.createElement("div"),this.dragSearchContent.className="dragSearch-content dragSearch-hide",this.dragSearchContent.style.top=this.selectHeight+"px";var a=e.createElement("div");a.className="dragSearch-input-area",this.dragSearchContent.appendChild(a),this.dragSearchInput=e.createElement("input"),this.dragSearchInput.type="text",this.dragSearchInput.autocomplete="off","string"==typeof this.config.placeholder&&this.trim(this.config.placeholder)&&(this.dragSearchInput.placeholder=this.config.placeholder),this.dragSearchInput.className="dragSearch-input",a.appendChild(this.dragSearchInput),this.dragSearchHidden=e.createElement("input"),this.dragSearchHidden.type="hidden",this.dragSearchHidden.name=this.select.name,a.appendChild(this.dragSearchHidden),this.createList(t),this.dragSearchArea.appendChild(this.dragSearchContent),this.toggle(),this.toSearch(t),this.toSelect(t)},t.prototype.createList=function(t){var a=e.createElement("div");if(a.className="dragSearch-list-box",a.style.maxHeight="number"==typeof this.config.maxHeight&&this.config.maxHeight?this.config.maxHeight-48+"px":"string"==typeof this.config.maxHeight&&this.trim(this.config.maxHeight)&&/^\d+\s*px$/.test(this.trim(this.config.maxHeight))?parseFloat(this.config.maxHeight)-48+"px":parseFloat(this.defaultConfig.maxHeight)-48+"px",this.dragSearchContent.appendChild(a),this.dragSearchList=e.createElement("ul"),this.dragSearchList.className="dragSearch-list",a.appendChild(this.dragSearchList),this.createNoData(),this.createNotMatch(),!(t.data instanceof Array))throw new Error("传入的数据必须是数组格式");if(t.data.length){if("undefined"==typeof t.data[0].value||"undefined"==typeof t.data[0].text)throw new Error("传入的数据格式不正确");this.noData=!1,this.isNoData();var r="",h=!1;this.selectIndex="";for(var s=0;s<t.data.length;s++)t.data[s].selected&&!h?(r+='<li class="dragSearch-selected"><a>'+t.data[s].text+"</a></li>",h=!0,this.selectIndex=s,this.res={value:t.data[s].value,text:t.data[s].text}):r+="<li><a>"+t.data[s].text+"</a></li>";this.dragSearchList.innerHTML=r,h&&(this.dragSearchText.innerHTML=this.res.text,this.dragSearchHidden.value=this.res.value,"function"==typeof t.success&&t.success(this.res,null))}else this.noData=!0,this.isNoData()},t.prototype.createNoData=function(){this.dragSearchNoData=e.createElement("div"),this.dragSearchNoData.className="dragSearch-noData",this.dragSearchNoData.style.display="none",this.dragSearchNoData.innerHTML="暂无数据~~",this.dragSearchContent.appendChild(this.dragSearchNoData)},t.prototype.createNotMatch=function(){this.dragSearchNotMatch=e.createElement("div"),this.dragSearchNotMatch.className="dragSearch-noData",this.dragSearchNotMatch.style.display="none",this.dragSearchNotMatch.innerHTML="没有匹配的内容~~",this.dragSearchContent.appendChild(this.dragSearchNotMatch)},t.prototype.isNoData=function(){this.noData?(this.dragSearchNoData.style.display="block",this.dragSearchList.style.display="none",this.dragSearchNotMatch.style.display="none"):(this.dragSearchNoData.style.display="none",this.dragSearchList.style.display="block")},t.prototype.isNotMatch=function(){this.notMatch?(this.dragSearchList.style.display="none",this.dragSearchNotMatch.style.display="block"):(this.dragSearchList.style.display="block",this.dragSearchNotMatch.style.display="none")},t.prototype.toggle=function(){var e=this;this.dragSearchHeader.onmousedown=function(t){var t=t||window.event;(0==t.button||1==t.button)&&(t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,e.hasClass(e.dragSearchContent,"dragSearch-hide")?(e.removeClass(e.dragSearchContent,"dragSearch-hide"),e.removeClass(e.dragSearchCaret,"dragSearch-caret-down"),e.addClass(e.dragSearchCaret,"dragSearch-caret-up"),setTimeout(function(){e.dragSearchInput.focus()})):(e.addClass(e.dragSearchContent,"dragSearch-hide"),e.removeClass(e.dragSearchCaret,"dragSearch-caret-up"),e.addClass(e.dragSearchCaret,"dragSearch-caret-down")))}},t.prototype.toSearch=function(e){var t=this;this.dragSearchInput.oninput=function(){var a=t.trim(this.value);t.searchToList(e,a)},this.dragSearchInput.onkeyup=function(a){var a=a||window.event,r=t.trim(this.value);t.searchToList(e,r)},this.dragSearchInput.onpropertychange=function(a){var a=a||window.event,r=t.trim(this.value);"value"==a.propertyName.toLowerCase()&&t.searchToList(e,r)},this.dragSearchInput.onblur=function(){var a=this;setTimeout(function(){t.removeClass(t.dragSearchCaret,"dragSearch-caret-up"),t.addClass(t.dragSearchCaret,"dragSearch-caret-down"),t.addClass(t.dragSearchContent,"dragSearch-hide"),a.value="",t.searchToList(e,"")},20)}},t.prototype.toSelect=function(e){var t=this,a=this.dragSearchList.getElementsByTagName("li");if(a&&a.length)for(var r=0;r<a.length;r++)this.hasClass(a[r],"dragSearch-toBottom")||!function(r){a[r].onmousedown=function(a){var a=a||window.event;(0==a.button||1==a.button)&&(t.res={value:e.data[r].value,text:e.data[r].text},t.dragSearchText.innerHTML=t.res.text,t.dragSearchHidden.value=t.res.value,t.getOneSelected(t.json,t.res.value),"function"==typeof e.success&&e.success(t.res,a))}}(r)},t.prototype.searchToList=function(e,t){if(e.data instanceof Array&&e.data.length&&"undefined"!=typeof e.data[0].value&&"undefined"!=typeof e.data[0].text){var a=this.dragSearchList.getElementsByTagName("li"),r=!1;if(a&&a.length){for(var h=0;h<a.length;h++)a[h].getElementsByTagName("a")[0].innerHTML.indexOf(this.trim(t))>-1?(this.removeClass(a[h],"dragSearch-hide"),r=!0):this.addClass(a[h],"dragSearch-hide"),this.removeClass(a[h],"dragSearch-selected");for(var h=0;h<a.length;h++)this.selectIndex===h&&this.addClass(a[h],"dragSearch-selected")}this.notMatch=r?!1:!0,this.isNotMatch()}},t.prototype.getOneSelected=function(e,t){if(e.data instanceof Array){for(var a=0;a<e.data.length;a++)e.data[a].selected=!1;for(var r=!1,a=0;a<e.data.length;a++)e.data[a].value!==t||r||(e.data[a].selected=!0,r=!0,this.selectIndex=a)}},t.prototype.extend=function(e,t){if("object"!=typeof e)return t;for(var a in t)t.hasOwnProperty(a)&&!e.hasOwnProperty(a)&&(e[a]=t[a]);return e},t.prototype.copyObj=function(e){if("object"!=typeof e)return e;var t=JSON.stringify(e);return JSON.parse(t)},t.prototype.trim=function(e){return e.replace(/^\s* | \s*$/g,"")},t.prototype.hasClass=function(e,t){for(var a=e.className.split(/\s+/),r=0;r<a.length;r++)if(a[r]==t)return!0;return!1},t.prototype.addClass=function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},t.prototype.removeClass=function(e,t){if(this.hasClass(e,t)){for(var a=e.className.split(/\s+/),r=0;r<a.length;r++)a[r]==t&&(a.splice(r,1),r--);e.className=a.join(" ")}},t.prototype.getByClass=function(t,a){for(var a=a||e,r=a.getElementsByTagName("*"),h=[],s=0;s<r.length;s++)this.hasClass(r[s],t)&&h.push(r[s]);return h},window.dragSearch=t}(document);